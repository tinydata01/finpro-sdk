/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, ViewChildren } from '@angular/core';
import { FormGroup, FormControl } from '@angular/forms';
import { KeysPipe } from '../pipes/keys.pipe';
import { Setting } from '../models/setting';
import { CounterDirective } from '../directives/timer.directive';
var OtpInputComponent = /** @class */ (function () {
    function OtpInputComponent(keysPipe) {
        this.keysPipe = keysPipe;
        this.setting = {
            length: 4,
            timer: 0
        };
        this.onValueChange = new EventEmitter();
        this.inputControls = new Array(this.setting.length);
        this.componentKey = Math.random().toString(36).substring(2) + (new Date()).getTime().toString(36);
    }
    /**
     * @return {?}
     */
    OtpInputComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.otpForm = new FormGroup({});
        for (var index = 0; index < this.setting.length; index++) {
            this.otpForm.addControl(this.getControlName(index), new FormControl());
        }
    };
    /**
     * @return {?}
     */
    OtpInputComponent.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var containerItem = document.getElementById("c_" + this.componentKey);
        if (containerItem) {
            /** @type {?} */
            var ele = containerItem.getElementsByClassName('.otp-input')[0];
            if (ele && ele.focus) {
                ele.focus();
            }
        }
    };
    /**
     * @private
     * @param {?} idx
     * @return {?}
     */
    OtpInputComponent.prototype.getControlName = /**
     * @private
     * @param {?} idx
     * @return {?}
     */
    function (idx) {
        return "ctrl_" + idx;
    };
    /**
     * @param {?} e
     * @return {?}
     */
    OtpInputComponent.prototype.isLeftArrow = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        return this.isKeyCode(e, 37);
    };
    /**
     * @param {?} e
     * @return {?}
     */
    OtpInputComponent.prototype.isRightArrow = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        return this.isKeyCode(e, 39);
    };
    /**
     * @param {?} e
     * @return {?}
     */
    OtpInputComponent.prototype.isBackspaceOrDelete = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        return e.key === "Backspace" || e.key === "Delete" || this.isKeyCode(e, 8) || this.isKeyCode(e, 46);
    };
    /**
     * @param {?} e
     * @param {?} targetCode
     * @return {?}
     */
    OtpInputComponent.prototype.isKeyCode = /**
     * @param {?} e
     * @param {?} targetCode
     * @return {?}
     */
    function (e, targetCode) {
        /** @type {?} */
        var key = e.keyCode || e.charCode;
        if (key == targetCode) {
            return true;
        }
        return false;
    };
    /**
     * @param {?} e
     * @param {?} inputIdx
     * @return {?}
     */
    OtpInputComponent.prototype.keyUp = /**
     * @param {?} e
     * @param {?} inputIdx
     * @return {?}
     */
    function (e, inputIdx) {
        /** @type {?} */
        var nextInputId = this.appendKey("otp_" + (inputIdx + 1));
        /** @type {?} */
        var prevInputId = this.appendKey("otp_" + (inputIdx - 1));
        if (this.isRightArrow(e)) {
            this.setSelected(nextInputId);
            return;
        }
        if (this.isLeftArrow(e)) {
            this.setSelected(prevInputId);
            return;
        }
        /** @type {?} */
        var isBackspace = this.isBackspaceOrDelete(e);
        if (isBackspace && !e.target.value) {
            this.setSelected(prevInputId);
            this.rebuildValue();
            return;
        }
        if (!e.target.value) {
            return;
        }
        if (this.isValidEntry(e)) {
            this.focusTo(nextInputId);
        }
        this.rebuildValue();
    };
    /**
     * @param {?} id
     * @return {?}
     */
    OtpInputComponent.prototype.appendKey = /**
     * @param {?} id
     * @return {?}
     */
    function (id) {
        return id + "_" + this.componentKey;
    };
    /**
     * @param {?} eleId
     * @return {?}
     */
    OtpInputComponent.prototype.setSelected = /**
     * @param {?} eleId
     * @return {?}
     */
    function (eleId) {
        this.focusTo(eleId);
        /** @type {?} */
        var ele = document.getElementById(eleId);
        if (ele && ele.setSelectionRange) {
            setTimeout((/**
             * @return {?}
             */
            function () {
                ele.setSelectionRange(0, 1);
            }), 0);
        }
    };
    /**
     * @param {?} e
     * @return {?}
     */
    OtpInputComponent.prototype.isValidEntry = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        /** @type {?} */
        var inp = String.fromCharCode(e.keyCode);
        /** @type {?} */
        var isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        return isMobile || /[a-zA-Z0-9-_]/.test(inp) || (this.setting.allowKeyCodes && this.setting.allowKeyCodes.includes(e.keyCode)) || (e.keyCode >= 96 && e.keyCode <= 105);
    };
    /**
     * @param {?} eleId
     * @return {?}
     */
    OtpInputComponent.prototype.focusTo = /**
     * @param {?} eleId
     * @return {?}
     */
    function (eleId) {
        /** @type {?} */
        var ele = document.getElementById(eleId);
        if (ele) {
            ele.focus();
            ele.selectionStart = ele.selectionEnd = 100;
        }
    };
    /**
     * @return {?}
     */
    OtpInputComponent.prototype.rebuildValue = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var val = '';
        this.keysPipe.transform(this.otpForm.controls).forEach((/**
         * @param {?} k
         * @return {?}
         */
        function (k) {
            if (_this.otpForm.controls[k].value) {
                val += _this.otpForm.controls[k].value;
            }
        }));
        this.onValueChange.emit(val);
    };
    /**
     * @param {?} e
     * @return {?}
     */
    OtpInputComponent.prototype.onCounterChange = /**
     * @param {?} e
     * @return {?}
     */
    function (e) {
        this.counter = e;
        if (this.counter == 0) {
            this.onValueChange.emit(-1);
        }
    };
    /**
     * @return {?}
     */
    OtpInputComponent.prototype.ressendOtp = /**
     * @return {?}
     */
    function () {
        this.CounterDirective.first.startTimer();
        this.onValueChange.emit(-2);
    };
    OtpInputComponent.decorators = [
        { type: Component, args: [{
                    selector: 'otp',
                    template: "<div class=\"otp-container {{setting.wrapperClass}}\" id=\"c_{{componentKey}}\" *ngIf=\"otpForm?.controls\"\n    [ngStyle]=\"setting.wrapperStyles\">\n    <input \n        [type]=\"setting.numbersOnly ? 'tel' : 'text'\" \n        numberOnly [disabledNumberOnly]=\"!setting.numbersOnly\"\n        [ngStyle]=\"setting.inputStyles\" \n        maxlength=\"1\" \n        class=\"otp-input {{setting.inputClass}}\" \n        autocomplete=\"off\"\n        *ngFor=\"let item of otpForm?.controls | keys; let i = index\" \n        [formControl]=\"otpForm.controls[item]\"\n        id=\"otp_{{i}}_{{componentKey}}\" \n        (keyup)=\"keyUp($event, i)\"\n    >\n    <ng-container counter [counter]=\"setting.timer\" (value)=\"onCounterChange($event)\">\n        <div>\n            <button class=\"btn {{setting.btnClass}}\" [disabled]=\"counter != 0\" (click)=\"ressendOtp()\">\n                Resend OTP <span *ngIf=\"counter != 0\">in {{ counter }} seconds.</span>\n            </button>\n        </div>\n    </ng-container>\n</div>",
                    styles: [".otp-input{width:2em;height:2em;border-radius:4px;border:1px solid #c5c5c5;text-align:center;font-size:28px}.otp-input:focus{outline-offset:0;outline:#2b91e2 auto 5px}.otp-container .otp-input:not(:last-child){margin-right:8px}@media screen and (max-width:767px){.otp-input{font-size:24px}}@media screen and (max-width:420px){.otp-input{font-size:18px}}"]
                }] }
    ];
    /** @nocollapse */
    OtpInputComponent.ctorParameters = function () { return [
        { type: KeysPipe }
    ]; };
    OtpInputComponent.propDecorators = {
        setting: [{ type: Input }],
        onValueChange: [{ type: Output }],
        CounterDirective: [{ type: ViewChildren, args: [CounterDirective,] }]
    };
    return OtpInputComponent;
}());
export { OtpInputComponent };
if (false) {
    /** @type {?} */
    OtpInputComponent.prototype.setting;
    /** @type {?} */
    OtpInputComponent.prototype.onValueChange;
    /** @type {?} */
    OtpInputComponent.prototype.CounterDirective;
    /** @type {?} */
    OtpInputComponent.prototype.otpForm;
    /** @type {?} */
    OtpInputComponent.prototype.inputControls;
    /** @type {?} */
    OtpInputComponent.prototype.componentKey;
    /** @type {?} */
    OtpInputComponent.prototype.counter;
    /**
     * @type {?}
     * @private
     */
    OtpInputComponent.prototype.keysPipe;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5ndWxhci1vdHAtaW5wdXQuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vYW5ndWxhci1vdHAtYm94LyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvYW5ndWxhci1vdHAtaW5wdXQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM3RixPQUFPLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3hELE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUM5QyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDNUMsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFFakU7SUFrQkMsMkJBQW9CLFFBQWtCO1FBQWxCLGFBQVEsR0FBUixRQUFRLENBQVU7UUFYN0IsWUFBTyxHQUFZO1lBQzNCLE1BQU0sRUFBRSxDQUFDO1lBQ1QsS0FBSyxFQUFFLENBQUM7U0FDUixDQUFDO1FBQ1Esa0JBQWEsR0FBRyxJQUFJLFlBQVksRUFBTyxDQUFDO1FBR2xELGtCQUFhLEdBQWtCLElBQUksS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDOUQsaUJBQVksR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxFQUFFLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7SUFHcEQsQ0FBQzs7OztJQUVuQyxvQ0FBUTs7O0lBQWY7UUFDQyxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksU0FBUyxDQUFDLEVB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SztvQkFDZiw4Z0NBQWlEOztpQkFFakQ7Ozs7Z0JBUlEsUUFBUTs7OzBCQVdmLEtBQUs7Z0NBSUwsTUFBTTttQ0FDTixZQUFZLFNBQUMsZ0JBQWdCOztJQTBIL0Isd0JBQUM7Q0FBQSxBQXRJRCxJQXNJQztTQWhJWSxpQkFBaUI7OztJQUM3QixvQ0FHRTs7SUFDRiwwQ0FBa0Q7O0lBQ2xELDZDQUFpRDs7SUFDakQsb0NBQW1COztJQUNuQiwwQ0FBOEQ7O0lBQzlELHlDQUE2Rjs7SUFDN0Ysb0NBQXVCOzs7OztJQUVYLHFDQUEwQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBJbnB1dCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIsIFZpZXdDaGlsZHJlbiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRm9ybUdyb3VwLCBGb3JtQ29udHJvbCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IEtleXNQaXBlIH0gZnJvbSAnLi4vcGlwZXMva2V5cy5waXBlJztcbmltcG9ydCB7IFNldHRpbmcgfSBmcm9tICcuLi9tb2RlbHMvc2V0dGluZyc7XG5pbXBvcnQgeyBDb3VudGVyRGlyZWN0aXZlIH0gZnJvbSAnLi4vZGlyZWN0aXZlcy90aW1lci5kaXJlY3RpdmUnO1xuXG5AQ29tcG9uZW50KHtcblx0c2VsZWN0b3I6ICdvdHAnLFxuXHR0ZW1wbGF0ZVVybDogJy4vYW5ndWxhci1vdHAtaW5wdXQuY29tcG9uZW50Lmh0bWwnLFxuXHRzdHlsZVVybHM6IFsnLi9hbmd1bGFyLW90cC1pbnB1dC5jb21wb25lbnQuc2NzcyddXG59KVxuXG5leHBvcnQgY2xhc3MgT3RwSW5wdXRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuXHRASW5wdXQoKSBzZXR0aW5nOiBTZXR0aW5nID0geyBcblx0XHRsZW5ndGg6IDQsIFxuXHRcdHRpbWVyOiAwXG5cdH07XG5cdEBPdXRwdXQoKSBvblZhbHVlQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cdEBWaWV3Q2hpbGRyZW4oQ291bnRlckRpcmVjdGl2ZSkgQ291bnRlckRpcmVjdGl2ZTtcblx0b3RwRm9ybTogRm9ybUdyb3VwO1xuXHRpbnB1dENvbnRyb2xzOiBGb3JtQ29udHJvbFtdID0gbmV3IEFycmF5KHRoaXMuc2V0dGluZy5sZW5ndGgpO1xuXHRjb21wb25lbnRLZXkgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoMikgKyAobmV3IERhdGUoKSkuZ2V0VGltZSgpLnRvU3RyaW5nKDM2KTtcblx0cHVibGljIGNvdW50ZXI6IG51bWJlcjtcblx0XG5cdGNvbnN0cnVjdG9yKHByaXZhdGUga2V5c1BpcGU6IEtleXNQaXBlKSB7fVxuXG5cdHB1YmxpYyBuZ09uSW5pdCgpOiB2b2lkIHtcblx0XHR0aGlzLm90cEZvcm0gPSBuZXcgRm9ybUdyb3VwKHt9KVxuXHRcdGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCB0aGlzLnNldHRpbmcubGVuZ3RoOyBpbmRleCsrKSB7XG5cdFx0XHR0aGlzLm90cEZvcm0uYWRkQ29udHJvbCh0aGlzLmdldENvbnRyb2xOYW1lKGluZGV4KSwgbmV3IEZvcm1Db250cm9sKCkpXG5cdFx0fVxuXHR9XG5cdFxuXHRwdWJsaWMgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xuXHRcdGxldCBjb250YWluZXJJdGVtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGNfJHt0aGlzLmNvbXBvbmVudEtleX1gKTtcblx0XHRpZiAoY29udGFpbmVySXRlbSkge1xuXHRcdFx0bGV0IGVsZTogYW55ID0gY29udGFpbmVySXRlbS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCcub3RwLWlucHV0JylbMF1cblx0XHRcdGlmIChlbGUgJiYgZWxlLmZvY3VzKSB7XG5cdFx0XHRcdGVsZS5mb2N1cygpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdHByaXZhdGUgZ2V0Q29udHJvbE5hbWUoaWR4KSB7XG5cdFx0cmV0dXJuIGBjdHJsXyR7aWR4fWA7XG5cdH1cblxuXHRpc0xlZnRBcnJvdyhlKSB7XG5cdFx0cmV0dXJuIHRoaXMuaXNLZXlDb2RlKGUsIDM3KTtcblx0fVxuXG5cdGlzUmlnaHRBcnJvdyhlKSB7XG5cdFx0cmV0dXJuIHRoaXMuaXNLZXlDb2RlKGUsIDM5KTtcblx0fVxuXG5cdGlzQmFja3NwYWNlT3JEZWxldGUoZSkge1xuXHRcdHJldHVybiBlLmtleSA9PT0gXCJCYWNrc3BhY2VcIiB8fCBlLmtleSA9PT0gXCJEZWxldGVcIiB8fCB0aGlzLmlzS2V5Q29kZShlLCA4KSB8fCB0aGlzLmlzS2V5Q29kZShlLCA0Nik7XG5cdH1cblxuXHRpc0tleUNvZGUoZSwgdGFyZ2V0Q29kZSkge1xuXHRcdHZhciBrZXkgPSBlLmtleUNvZGUgfHwgZS5jaGFyQ29kZTtcblx0XHRpZihrZXkgPT0gdGFyZ2V0Q29kZSkgeyByZXR1cm4gdHJ1ZTsgfVxuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXG5cdGtleVVwKGUsIGlucHV0SWR4OiBudW1iZXIpIHtcblx0XHRsZXQgbmV4dElucHV0SWQgPSB0aGlzLmFwcGVuZEtleShgb3RwXyR7aW5wdXRJZHggKyAxfWApO1xuXHRcdGxldCBwcmV2SW5wdXRJZCA9IHRoaXMuYXBwZW5kS2V5KGBvdHBfJHtpbnB1dElkeCAtIDF9YCk7XG5cdFx0aWYgKHRoaXMuaXNSaWdodEFycm93KGUpKSB7XG5cdFx0XHR0aGlzLnNldFNlbGVjdGVkKG5leHRJbnB1dElkKTtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cdFx0aWYgKHRoaXMuaXNMZWZ0QXJyb3coZSkpIHtcblx0XHRcdHRoaXMuc2V0U2VsZWN0ZWQocHJldklucHV0SWQpO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0XHRsZXQgaXNCYWNrc3BhY2UgPSB0aGlzLmlzQmFja3NwYWNlT3JEZWxldGUoZSk7XG5cdFx0aWYgKGlzQmFja3NwYWNlICYmICFlLnRhcmdldC52YWx1ZSkge1xuXHRcdFx0dGhpcy5zZXRTZWxlY3RlZChwcmV2SW5wdXRJZCk7XG5cdFx0XHR0aGlzLnJlYnVpbGRWYWx1ZSgpO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblx0XHRpZiAoIWUudGFyZ2V0LnZhbHVlKSB7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXHRcdGlmICh0aGlzLmlzVmFsaWRFbnRyeShlKSkge1xuXHRcdFx0dGhpcy5mb2N1c1RvKG5leHRJbnB1dElkKTtcblx0XHR9XG5cdFx0dGhpcy5yZWJ1aWxkVmFsdWUoKTtcblx0fVxuXG5cdGFwcGVuZEtleShpZCkge1xuXHRcdHJldHVybiBgJHtpZH1fJHt0aGlzLmNvbXBvbmVudEtleX1gO1xuXHR9XG5cblx0c2V0U2VsZWN0ZWQoZWxlSWQpIHtcblx0XHR0aGlzLmZvY3VzVG8oZWxlSWQpO1xuXHRcdGxldCBlbGU6IGFueSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZUlkKTtcblx0XHRpZiAoZWxlICYmIGVsZS5zZXRTZWxlY3Rpb25SYW5nZSkge1xuXHRcdFx0c2V0VGltZW91dCgoKSA9PiB7XG5cdFx0XHRcdGVsZS5zZXRTZWxlY3Rpb25SYW5nZSgwLCAxKTtcblx0XHRcdH0sIDApO1xuXHRcdH1cblx0fVxuXG5cdGlzVmFsaWRFbnRyeShlKSB7XG5cdFx0dmFyIGlucCA9IFN0cmluZy5mcm9tQ2hhckNvZGUoZS5rZXlDb2RlKTtcblx0XHR2YXIgaXNNb2JpbGUgPSAvaVBob25lfGlQYWR8aVBvZHxBbmRyb2lkL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KTtcblx0XHRyZXR1cm4gaXNNb2JpbGUgfHwgL1thLXpBLVowLTktX10vLnRlc3QoaW5wKSB8fCAodGhpcy5zZXR0aW5nLmFsbG93S2V5Q29kZXMgJiYgdGhpcy5zZXR0aW5nLmFsbG93S2V5Q29kZXMuaW5jbHVkZXMoZS5rZXlDb2RlKSkgfHwgKGUua2V5Q29kZSA+PSA5NiAmJiBlLmtleUNvZGUgPD0gMTA1KTtcblx0fVxuXG5cdGZvY3VzVG8oZWxlSWQpIHtcblx0XHRsZXQgZWxlOiBhbnkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVJZCk7XG5cdFx0aWYgKGVsZSkge1xuXHRcdFx0ZWxlLmZvY3VzKCk7XG5cdFx0XHRlbGUuc2VsZWN0aW9uU3RhcnQgPSBlbGUuc2VsZWN0aW9uRW5kID0gMTAwO1xuXHRcdH1cblx0fVxuXG5cdHJlYnVpbGRWYWx1ZSgpIHtcblx0XHRsZXQgdmFsID0gJyc7XG5cdFx0dGhpcy5rZXlzUGlwZS50cmFuc2Zvcm0odGhpcy5vdHBGb3JtLmNvbnRyb2xzKS5mb3JFYWNoKGsgPT4ge1xuXHRcdFx0aWYgKHRoaXMub3RwRm9ybS5jb250cm9sc1trXS52YWx1ZSkge1xuXHRcdFx0XHR2YWwgKz0gdGhpcy5vdHBGb3JtLmNvbnRyb2xzW2tdLnZhbHVlO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHRcdHRoaXMub25WYWx1ZUNoYW5nZS5lbWl0KHZhbCk7XG5cdH1cblxuXHRwdWJsaWMgb25Db3VudGVyQ2hhbmdlKGUpOiB2b2lkIHtcblx0XHR0aGlzLmNvdW50ZXIgPSBlO1xuXHRcdGlmKHRoaXMuY291bnRlciA9PSAwKSB7XG5cdFx0XHR0aGlzLm9uVmFsdWVDaGFuZ2UuZW1pdCgtMSk7XG5cdFx0fVxuXHR9XG5cblx0cmVzc2VuZE90cCgpOiB2b2lkIHtcblx0XHR0aGlzLkNvdW50ZXJEaXJlY3RpdmUuZmlyc3Quc3RhcnRUaW1lcigpO1xuXHRcdHRoaXMub25WYWx1ZUNoYW5nZS5lbWl0KC0yKTtcblx0fVxufSJdfQ==